<p>
  <h1><%= @event.name %></h1>
  <h2>Managed by: <%= @event.owner.full_name %></h2>
  <% if @event.start_date %>
    <h2>Official Start Time:
    <%= @event.start_date.strftime('%a, %d %b, %H:%M:%S') %>
  <% else %>
    Official Start Time Pending...
  <% end %></h2>
</p>

<div class='card'>
  <div class='card-header'><h3>Event Scoring</h3></div>
  <div class='card-text' id='eventScoring'>
    <table class="table table-sm table-hover table-striped">
      <thead>
        <th scope='col'>Athlete</th>
        <th scope='col'>Points</th>
      </thead>
        <% @points.each do |k, v| %>
          <tr>
          <td scope='row'><%= k.full_name %></td>
          <td scope='row'><%= v %></td>
          </tr>
        <% end %>
    </table>
  </div>
  <div class='card'>
    <% if @table %>
      <div class='card-header'><h3>Segment Times</h3></div>
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <% @table[0].each do |cell| %>
                <th><%= cell %></th>
                <% end %>
            </tr>
          </thead>
          <% @table[1, @table.size-1].each do |row| %>
          <tr>
            <% row.each do |cell| %>
              <% if cell.is_a? Hash %>
                <td><%= Time.at(cell[:time]).strftime('%H:%M:%S') %>
                <% if cell[:trophy] > 0 %>
                  <%= show_trophy cell[:trophy] %>
                <% end %>  
                  </td>
              <% else %>
                <td><%= cell %></td>
              <% end %>
            <% end %>
          </tr>
          <% end %>
        </table>
      </div>
    <% else %>
      <strong>Add some athletes or segments to create the results table!</strong>
    <% end %>
  </div>
</div>
<a href="#" id="eventBuilder" class="btn btn-primary">
Show/Hide Event Builder  
</a>

<div id="eventBuilder" class='card'>
  <div class='card-header'><h3>Team Roster</h3></div>
  <div class='card-text'>
    <% if @team.size == 0 %>
      Looks like you're not managing anyone yet. You should try heading to the 
      <%= link_to "Users' Page", users_path %>.  from there, click on some 
      profiles and start building your team.
    <% else %>
      <table>
        <tr>
          <% @team.each do |user| %>
            <td><%= render 'participant_form', user: user, 'size' => 100 %></td>
          <% end %>
        </tr>
      </table>
    <% end %>
  </div>
  <div class='card-header'><h3>Featured Segments <span class='badge'><%= @features.size %></span></h3></div>
  <div>
    <% if @features.size == 0 %>
      No segments are currently featured.
    <% else %>
      <table  class="panel panel-default">
      <% @features.each do |segment| %>
        <tr>
        <td><%= link_to segment.name, segment %></td>
        <td><%= render 'feature_form', segment: segment %></td>
        </tr>
      <% end %>
      </table>
    <% end %>
  </div>
  <div class='card-header'><h3>Available Segments <span class='badge'> <%= @segments.size %></span></h3></div>
    
  <div id='segment_table' class='card-text collapse in'>
    <% if @segments.size == 0 %>
      No activities are included currently.
    <% else %>
      <input class="form-control" id="segment_search" type="text" width='200' placeholder="Search..">
  
      <table class="panel panel-default">
      <% @segments.each do |segment| %>
        <tr>
          <td><%= link_to segment.name, segment %></td>
          <td>Efforts: <%= segment.efforts.count %> | </td>
          <td>Featured: <%= segment.featured_by.count %> | </td>
          <td>Distance: <%= segment.distance.to_s %> m. | </td>
          <td>Elevation: <%= segment.elevation_gain %> | </td>
          <td>Avg Grade: <%= segment.average_grade %> </td>
          <td><%= render 'feature_form', segment: segment %></td>
        </tr>
      <% end %>
      </table>
    <% end %>
  </div>
    <strong>Available Activities:</strong></br> 
    <% if @activities.size == 0 %>
      No activities are included currently.
    <% else %>
      <% @activities.each do |activity| %><br> 
        <%= activity.user.full_name %> -> <%= link_to activity.name, activity %>
      <% end %>
    <% end %>
  </div></br>